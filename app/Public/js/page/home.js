/**  * kuaihuojian project - kuaihuojian project  */ "use strict";function changeYzm(){$(".yzm").attr("src","/Login/verify.html?t="+Math.random())}function setCookie(e,i){var a=30,o=new Date;o.setTime(o.getTime()+24*a*60*60*1e3),document.cookie=e+"="+escape(i)+";expires="+o.toGMTString()}function getCookie(e){var i,a=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(i=document.cookie.match(a))?unescape(i[2]):null}$(function(){$.fn.tagSlider=function(e){function i(e){r=e,n=window.setTimeout(function(){i(r),r=r<p-1?r+1:0},m),s||(l.animate({"margin-left":-(e*u)},g),a(e))}function a(e){c.removeClass("curr"),c.eq(e).addClass("curr")}var o={},t=$.extend({},o,e),l=$("#"+t.screen),n=null,r=0,d=$(this),c=d.find(t.btnItem),s=!1,u=t.width,m=t.stepTimer||1500,g=t.animateTimer||200,p=t.size;return i(0),c.each(function(e,a){$(a).click(function(){window.clearInterval(n);var e=$(this),a=c.index(e);s=!1,i(a),s=!0}),$(a).hover(function(){s=!0},function(){s=!1})})},$("#stepSliderBtn").tagSlider({btnItem:"li",screen:"stepSlider",width:917,stepTimer:2500,animateTimer:300,size:3}),$("#sliderNavi").tagSlider({btnItem:"li",screen:"swipeBox",width:911,stepTimer:3e3,animateTimer:300,size:5})}),$(function(){$("#uname").val(getCookie("KHJUserName")),$("#loginForm").validate({submitHandler:function(){var e=$("#uname").val(),i=$("#upwd").val(),a=$('input[name="logincode"]').val();$.ajax({url:"/Login/do_login_ajax",data:{username:e,pwd:md5(i),vycode:a},type:"post",cache:!1,dataType:"json",success:function(i){if(1==i.code){window.location.href=i.redirect_url;var a=$("#jzzh").prop("checked");a?setCookie("KHJUserName",e):setCookie("KHJUserName","")}else i.code==-1?alert(i.msg||"系统异常"):alert("服务器忙");changeYzm(),$('input[name="logincode"]').val("")},error:function(){alert("服务器忙")}})}}),$("#registerForm").validate({rules:{repwd:{equalTo:"#pwd"}},messages:{repwd:{equalTo:"两次密码输入不一致！"}},submitHandler:function(){var e=$("#username").val(),i=$("#pwd").val(),a=($("#repwd").val(),$("#realname").val()),o=$("#mobilephone").val(),t=$("#email").val(),l=$("#vycode").val(),n=$("input[name=gender]:checked").val(),r=($("#agree").hasClass("active"),$("#invite_code").val()),d=$("input[name='agree']:checked").val();return d?void $.ajax({url:"/Login/do_reg",data:{username:e,pwd:md5(i),realname:a,gender:n,mobilephone:o,email:t,code:l,invite_code:r},type:"post",cache:!1,dataType:"json",success:function(e){return 1!=e.code?e.code==-1?void alert(e.msg||"系统异常"):(alert("服务器忙"),!1):void(window.location.href=e.gourl)},error:function(){alert("服务器忙")}}):void alert("请先接受用户协议")}}),$("#backPwdEmailForm").validate({submitHandler:function(){backPwdEmailDialog.dialog("close");var e=$("#backPwdEmailForm").find("#uname").val();$.ajax({url:"/GetPassword/checkeml",data:{eml:e},type:"post",cache:!1,dataType:"json",success:function(e){alert(e.msg||"系统异常")},error:function(){alert("服务器忙")}})}}),$("#backPwdMobileForm").validate({rules:{backrepwd:{equalTo:"#backpwd"}},messages:{backrepwd:{equalTo:"两次密码输入不一致！"}},submitHandler:function(){var e=$("#backPwdMobileForm").find("#mobilephone").val(),i=$("#backPwdMobileForm"),a={mobilephone:i.find('input[name="mobilephone"]').val(),vycode:i.find('input[name="vycode"]').val(),backpwd:md5(i.find('input[name="backpwd"]').val()),backrepwd:md5(i.find('input[name="backrepwd"]').val())};$.ajax({url:"/Login/backPwdFromMobile",data:a,type:"post",cache:!1,dataType:"json",success:function(i){return 1!=i.code?i.code==-1?void alert(i.msg||"系统异常"):(alert("服务器忙"),!1):(backPwdMobileDialog.dialog("close"),$(".username").val(e),$("#loginDialog").dialog("open"),alert(i.msg),void 0)},error:function(){alert("服务器忙")}})}}),$("#resetPwdForm").validate({rules:{resetrepwd:{equalTo:"#resetpwd"}},messages:{resetrepwd:{equalTo:"两次密码输入不一致！"}},submitHandler:function(){}})});var InterFace_Url="/Login/judge_port",InterFace_Type="post",registerDialog=$("#registerDialog").dialog({autoOpen:!1,width:610,height:640,modal:!0,title:"用户注册"}),loginDialog=$("#loginDialog").dialog({width:610,height:440,modal:!0,title:"登录"}),backPwdEmailDialog=$("#backPwdEmailDialog").dialog({autoOpen:!1,width:610,height:300,modal:!0,title:"找回密码"}),backPwdMobileDialog=$("#backPwdMobileDialog").dialog({autoOpen:!1,width:610,height:440,modal:!0,title:"找回密码"}),resetPwdDialog=$("#resetPwdDialog").dialog({autoOpen:!1,width:610,height:330,modal:!0,title:"找回密码"}),backPwdEmailStateDialog=$("#backPwdEmailStateDialog").dialog({autoOpen:!1,width:610,height:330,modal:!0,title:"找回密码"}),protocol=$("#protocol").dialog({autoOpen:!1,width:800,height:500,modal:!0,title:"用户协议"}),currentSubmit=null;$(".protocol").click(function(){protocol.dialog("open")}),$(".register").click(function(){registerDialog.dialog("open"),currentSubmit=$("#registerForm")}),$(".login").click(function(e){changeYzm(),loginDialog.dialog("open"),currentSubmit=$("#loginForm"),e=window.event||e,e.stopPropagation()}),$(".forget").click(function(){loginDialog.dialog("close"),backPwdEmailDialog.dialog("open"),currentSubmit=$("#backPwdEmailForm")}),$(".backMobileBtn").click(function(){backPwdEmailDialog.dialog("close"),resetPwdDialog.dialog("close"),backPwdMobileDialog.dialog("open"),currentSubmit=$("#backPwdMobileForm")}),$(".backEmailBtn").click(function(){backPwdMobileDialog.dialog("close"),resetPwdDialog.dialog("close"),backPwdEmailDialog.dialog("open"),currentSubmit=$("#backPwdEmailForm")}),$("#backEmailSubmitBtn").click(function(){$("#backPwdEmailForm").submit()}),$("#backMobileSubmitBtn").click(function(){$("#backPwdMobileForm").submit()}),$("#mobileSubmitBtn").click(function(){$("#resetPwdForm").submit()}),$("#loginSubmitBtn").click(function(){$("#loginForm").submit()}),$("#registerSubmitBtn").click(function(){$("#registerForm").submit()}),$(document).keydown(function(e){e=window.event||e;var i=$(".ui-widget-overlay").size();1==i&&13==e.keyCode&&currentSubmit.submit()}),$(function(){function e(e){var i=!0;return $.ajax({url:InterFace_Url,type:InterFace_Type,async:!1,data:e,dataType:"json",success:function(e){i=e.success}}),i}function i(e,i){$.ajax({type:"post",url:"/Login/sendValidCode1",data:"mobilephone="+i,dataType:"json",success:function(i){if(1==i.code){$(e).hide(),e.prev().show().html("还剩59秒");var o=58;a=window.setInterval(function(){o<1&&(window.clearInterval(a),e.show(),e.prev().hide()),e.prev().html("还剩"+o+"秒"),o--},1e3)}else i.code==-1?alert(i.msg||"系统异常"):alert("服务器忙")},error:function(){alert("发送失败")}})}$(".jzmm, .jsxy").checkbox();var a=null;$('input[name="mobilephone"]').keyup(function(){var e=$(this),i=e.val()||"";/^1(3|4|5|7|8)\d{9}$/.test(i)?$(".pushMobile").removeClass("disabled"):$(".pushMobile").addClass("disabled")}),$.validator.addMethod("isExsitMobile",function(i,a){var o=$.trim($(a).val()),t=e({Type:2,Tag:o});return this.optional(a)?this.optional(a):(t?$(".pushMobile").removeClass("disabled"):$(".pushMobile").addClass("disabled"),t)},"电话已存在!"),$(".pushMobile").click(function(){var e=$(this),o=e.closest("form").find('input[name="mobilephone"]').val(),t=e.attr("data-backpwd");return/^1(3|4|5|7|8)\d{9}$/.test(o)?($(".pushMobile").removeClass("disabled"),t?(i(e,o),!1):void $.ajax({type:"post",url:"/Login/sendValidCode",data:"mobilephone="+o,dataType:"json",success:function(i){if(1==i.code){$(e).hide(),e.prev().show().html("还剩59秒");var o=58;a=window.setInterval(function(){o<1&&(window.clearInterval(a),e.show(),e.prev().hide()),e.prev().html("还剩"+o+"秒"),o--},1e3)}else i.code==-1?alert(i.message||"系统异常"):alert("服务器忙")},error:function(){alert("发送失败")}})):void $(".pushMobile").addClass("disabled")})});