/**  * kuaihuojian project - kuaihuojian project  */ "use strict";function check(e,t,n){$(".state-bar").eq(0).hide().next().show(),$("input[name='isBack']").val(0);var a=$('input[name="city"]').val()||"",l=$('input[name="job"]').val()||"",i=$('input[name="industry"]').val()||"",o=$('input[name="words"]').val()||"",c=$('input[name="age"]').val()||"",d=$('input[name="sex"]').val()||"",s=$('input[name="s"]').is(":checked")?1:0,u=$(".key").val(),r=$("input[name=endOrderIds]").val(),m=$("input[name=noSendNum]").is(":checked")?1:0;c=c.replace("全部年龄段,","");var h=$("input[name='splitcheck']:checked").val()||0;"index"==t&&(m=0,r="",u=""),$("#Pagination").pager({id:"#searchinfo",url:"/SearchCustomer/doSearch",data:{city:a,job:l,trade:i,extend:o,age:c,gender:d,page:1,extendType:s,count:u,orderids:r,splitcheck:h,checkNoSend:m},before:function(e){return!(comStatus<1&&e>3)||($("#queryErrorDialog").dialog("open"),!1)},callback:function(e){$(".search_result_state").show(),$(".customerNum").html(e.allnums+"人"),$(".totalCustomerNum").html(e.allnums+"人")}})}function reSearch(){window.location.reload()}$(function(){$(".checkbox").checkbox(),$("#searchInputText").keydown(function(e){e=window.event||e,13==e.keyCode&&(e.preventDefault?e.preventDefault():e.stopPropagation(),check(1,"list"))})}),$(document).on("click","[name=sendedNum]",function(){var e=$(this),t="";if(e.is(":checked"))$(".ajaxList").each(function(e){var n=(parseInt($("[name=endSendNum_h]").val()),$(this));if(t+=","+n.val(),!n.is(":checked")){parseInt(n.next("input[type=hidden]").val())}}),$(".ajaxList").prop("checked",!0);else{var n=(parseInt($("[name=endSendNum_h]").val()),0);$(".ajaxList").each(function(){var e=$(this),t=parseInt(e.next("input[type=hidden]").val());n+=t});$(".ajaxList").prop("checked",!1)}","==t.substr(0,1)&&(t=t.substr(1)),$("[name=endOrderIds]").val(t)});var len=$(".ajaxList").length,loop=len;$(document).on("click",".ajaxList",function(){var e=$(this),t=(parseInt($("[name=endSendNum_h]").val()),parseInt(e.next("input[type=hidden]").val()),"");if(e.is(":checked")){e.attr("checked",!0)}else{e.attr("checked",!1)}$(".ajaxList").not(":checked").length>0?$("[name=sendedNum]").prop("checked",!1):$("[name=sendedNum]").prop("checked",!0),$(".ajaxList:checked").each(function(){t+=","+$(this).val()}),","==t.substr(0,1)&&(t=t.substr(1)),$("[name=endOrderIds]").val(t)}),$(function(){$(document).keyup(function(e){e=window.event||e;var t=$(".ui-widget-overlay").size();13==e.keyCode&&0==t&&(check(1,"index"),searchResult(),$(".zhiwei").hide())}),$(".setPlanCenter").click(function(e){e=window.event||e;var t=+$(".customerNum").html().replace("人","");if(t>5e4){if(alert("单个订单人数不能超过50000人"),!e.preventDefault)return!1;e.preventDefault()}})}),$(function(){$("#queryErrorDialog").dialog({width:790,height:450,title:"查询失败",buttons:[{text:"去完善企业信息",click:function(){window.location.href=completeUrl}},{text:"再看看",click:function(){$(this).dialog("close")}}]})}),$(function(){$("#setPullPeopleDialog").dialog({width:580,height:450,title:"本次推送人数",buttons:[{text:"确定",click:function(){var e=$("#setPullPeopleData").find("input:checked").size();if(!e)return void alert("请勾选目标客户的范围");var t=$("[name=endSendNum]").val(),n=$("[name=endSendNum_h]").val();push_num=t?t:n,$(".benci").html(push_num+"人"),$(".key").val(push_num),$(this).dialog("close");var a="";$("#setPullPeopleDialog").find(".ajaxList:not(:checked)").each(function(e,t){a+=","+$(this).val()}),$("input[name='tuisongNoChecked']").val(a),check(1,"list")}}]});var e=!0;$(".setPullPeople").click(function(){$("#setPullPeopleDialog").dialog("open");var t=$(".benci").html(),n="本次推送人数："+t;$("#setPullPeopleDialog").prev().find(".ui-dialog-title").html(n);var a=$('input[name="city"]').val()||"",l=$('input[name="job"]').val()||"",i=$('input[name="industry"]').val()||"",o=$('input[name="words"]').val()||"",c=$('input[name="age"]').val()||"",d=$('input[name="sex"]').val()||"",s=$("input[name='tuisongNoChecked']").val()||"";$("input[name='endSendNum']").val(""),e&&($("input[name='noSendNum']").prop("checked",!0).closest(".btn").addClass("active"),e=!1),$.ajax({type:"post",dataType:"json",url:"/SearchCustomer/getListInfo",data:"city="+a+"&job="+l+"&trade="+i+"&extend="+o+"&age="+c+"&gender="+d,beforeSend:function(){$("#setPullPeopleLoading").show(),$("#setPullPeopleData").hide()},success:function(e){if($("#setPullPeopleDialog").find(".noSendNum").html(e.noSendNum+"人"),$("#setPullPeopleDialog").find("[name=noSendNum]").val(e.noSendNum),e.sendPlans>0){var t=parseInt($("#totalCustomerNumId").html()),n=t-parseInt(e.noSendNum);$("#setPullPeopleDialog").find(".sendedNum").html(e.sendPlans+"个计划/"+n+"人"),$('[name="sendedNum"]').attr("checked",!0)}else $("#setPullPeopleDialog").find(".sendedNum").html("0个计划/0人"),$('[name="sendedNum"]').attr("checked",!0);var a="";if(e.total_order){var l="";$.each(e.total_order,function(e,t){var n=t.num+"人";a+='<li class="item">',a+='<div class="t"></div>',s.indexOf(","+t.id)<0?(a+='<label class="btn btn-primary ml10 active">',a+=' <em class="fl icon"></em>',a+=' <input  data-moniter="pull-checkall" type="checkbox" autocomplete="off" id="'+t.id+'" name="orderId[]" class="ajaxList" checked value="'+t.id+'"/>',l+=","+t.id):(a+='<label class="btn btn-primary ml10">',a+=' <em class="fl icon"></em>',a+=' <input  data-moniter="pull-checkall" type="checkbox" autocomplete="off" id="'+t.id+'" name="orderId[]" class="ajaxList" value="'+t.id+'"/>'),a+=' <div class="name">'+t.time+"</div>",a+="</label>";var i="/SpreadPlan/action";a+='<div class="fl ml10"><a class="blue txtline" target="_blank" href="'+i+"?id="+t.id+'">'+t.plan_name+"</a></div>",a+='<div class="fr mr10 people">'+n+"</div>",a+="</li>"}),","==l.substr(0,1)&&(l=l.substr(1)),$("[name=endOrderIds]").val(l)}$("#setPullPeopleDialog").find(".list").html(a)},complete:function(){$("#setPullPeopleLoading").hide(),$("#setPullPeopleData").show()},error:function(){alert("服务器连接超时！")}})}),initCheckAll(),initCheckAll('[role="root-checkall"]','[data-moniter="root-checkall"]',".container"),initCheckAll('[role="sub-checkall"]','[data-moniter="sub-checkall"]',".item"),initCheckAll('[role="pull-checkall"]','[data-moniter="pull-checkall"]',".container"),$("input[name='endSendNum']").keyup(function(){var e=+parseInt($("#totalCustomerNumId").text()),t=$("#endSendNumAlert");t.text("");var n=+$(this).val(),a=null;return n<1?(window.clearTimeout(a),t.text("输入的值不能小于1人"),$(this).val(""),void window.setTimeout(function(){t.text("")},3e3)):n>5e4?(window.clearTimeout(a),t.text("单个订单人数不能超过50000人"),$(this).val(""),void window.setTimeout(function(){t.text("")},3e3)):n>e?(window.clearTimeout(a),t.text("已超出本次查询可推广最大人数"),$(this).val(e),void window.setTimeout(function(){t.text("")},3e3)):void 0})});