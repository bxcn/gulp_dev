/**  * kuaihuojian project - kuaihuojian project  */ "use strict";function checkForm(){return projectName=$("input[name='projectName']"),productName=$("input[name='productName']"),productDes=$("textarea[name='productDes']"),msgCnt=$("#msgCnt"),projectName.val()?productName.val()?!!msgCnt.val()||(msgCnt.focus(),!1):(productName.focus(),alert("没有签名不可推广，请修改签名！"),!1):(projectName.focus(),!1)}function statInputNumSMS(){var t=$("#msgCnt"),e=$("#tagName").html().length+6,n=t.val().length+e;showSMSGrap(n,e),t.on("keyup",function(){var t=$(this).val(),n=t.length+e;showSMSGrap(n,e)})}function showSMSGrap(t,e){var n=67,a=300,i=$("#typeIn"),o=$("#smsNumber");if(a<t){var l=$("#msgCnt").val();l=l.substring(0,a-e),t=a,$("#msgCnt").val(l)}i.text(t),o.text(Math.ceil(t/n)+"条");var c=$("#tageName").html(),r="回复TD退订",s=$("#msgCnt").val().replace(/\{姓名}/gi,"赵小龙"),s=s.replace(/\{称呼}/gi,"先生"),s=s.replace(/\http:\/\/az01.cn\/f\/\{链接标识}/gi,$("#hideUrl").val()),s=c+s+r;$(".viewMobileInfo").text(s)}function statInputNum(t,e,n,a){var i;t[0].setAttribute("maxlength",n),i=t.val().length,e.text(n-i),a.text(i),t.on("keyup",function(){a.text($(this).val().length)})}function insertName(t,e,n){var a=parseInt($("#typeIn").html());if("msgurl"==e||"mailurl"==e){var i=$.trim($(n).prev().val());if(""==i)return void alert("请输入短链接");if(!/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i.test(i))return alert("请输入以http://开头的有效链接"),!1;$(n).prev().val("");var o=changeShortUrl(i,e);return $("#typeIn").html(a+22),$("#"+t).insertAtCaret(o),void $("#msgCnt").trigger("keyup")}document.getElementById(t);return $("#"+t).insertAtCaret("{"+e+"}"),$("#typeIn").html(a+4),$("#msgCnt").trigger("keyup"),!1}function base64encode(t){var e,n,a,i,o,l;for(a=t.length,n=0,e="";n<a;){if(i=255&t.charCodeAt(n++),n==a){e+=base64EncodeChars.charAt(i>>2),e+=base64EncodeChars.charAt((3&i)<<4),e+="==";break}if(o=t.charCodeAt(n++),n==a){e+=base64EncodeChars.charAt(i>>2),e+=base64EncodeChars.charAt((3&i)<<4|(240&o)>>4),e+=base64EncodeChars.charAt((15&o)<<2),e+="=";break}l=t.charCodeAt(n++),e+=base64EncodeChars.charAt(i>>2),e+=base64EncodeChars.charAt((3&i)<<4|(240&o)>>4),e+=base64EncodeChars.charAt((15&o)<<2|(192&l)>>6),e+=base64EncodeChars.charAt(63&l)}return e}function changeShortUrl(t,e){var n="";return $.ajax({type:"post",url:getTinyurl,data:"url="+base64encode(t)+"&type="+e,dataType:"json",async:!1,success:function(t){t.status&&(n=t.tinyurl)}}),n}function openUrl(t){$(t).hide().next().show()}function syncHtmlToText(){window.editor.sync();var t=document.getElementById("mailCntTxt"),e=document.getElementById("mailCnt");t.value=stripHTMLWithLinks(e.value)}function stripHTMLWithLinks(t){var e=/([\s\S]*\<body[^\>]*\>)([\s\S]*)(\<\/body\>[\s\S]*)/i,n=t.match(e);return null!=n&&n[2]&&(t=n[2]),t=t.replace(/<a\s.*?href\s*=\s*"(.*?)".*?>(.*?)<\/a>/gi,"$2 [$1]"),t=t.replace(/<a\s.*?href\s*=\s*'(.*?)'.*?>(.*?)<\/a>/gi,"$2 [$1]"),t=t.replace(/\/\/--\>/gi,""),t=t.replace(/(\n)/gi,""),t=t.replace(/(\r)/gi,""),t=t.replace(/<title[^\>]*\>[\s\S]*\<\/title\>/gi,""),t=t.replace(/<br\s*\/\s*>/gi,"\n"),t=t.replace(/(<\/h.>|<\/p>|<\/div>)/gi,"$1\n\n"),t=t.replace(/<[^>]+>/g,""),t=t.replace(/&lt;/g,"<"),t=t.replace(/&gt;/g,">"),t=t.replace(/&nbsp;/g," ")}$("#tplCnt").validate({submitHandler:function(t){return checkForm()}}),KindEditor.ready(function(t){var e={width:"994px",minWidth:"600px",height:"300px",urlType:"domain",filterMode:!1,uploadJson:"/Public/editor/upload_json.php",fileManagerJson:"/Public/editor/file_manager_json.php",allowFileManager:!0};window.editor=t.create("#mailCnt",e)}),$(function(){var t=$("#tagName").html();$("#msgCnt").css({"text-indent":12*t.length-10+"px"});var e=$("#msgCnt"),n=$("#typeInAllow"),a=$("#typeIn"),i=$("#smsNumber"),o=300,l=$("#productDes"),c=$("#planTypeInAllow"),r=$("#planTypeIn"),s=200;statInputNumSMS(e,n,o,a,i),statInputNum(l,c,s,r),$("#typeInAllow").html(o)}),$("#sign").blur(function(){var t=$(this).val();t.length<3&&$(this).focus(),$("#msgCnt").val("【"+t+"】")}),function(t){t.fn.extend({insertAtCaret:function(e){var n=t(this)[0];if(document.selection)this.focus(),sel=document.selection.createRange(),sel.text=e,this.focus();else if(n.selectionStart||"0"==n.selectionStart){var a=n.selectionStart,i=n.selectionEnd,o=n.scrollTop;n.value=n.value.substring(0,a)+e+n.value.substring(i,n.value.length),this.focus(),n.selectionStart=a+e.length,n.selectionEnd=a+e.length,n.scrollTop=o}else this.value+=e,this.focus()}}),t(".insert-name").click(function(){t(".ke-icon-insertname").click()}),t(".insert-CITY").click(function(){t(".ke-icon-insertcity").click()}),t(".insert-JOB_NAME").click(function(){t(".ke-icon-insertjobname").click()}),t(".insert-JOB_NUM").click(function(){t(".ke-icon-insertjobnum").click()}),t(".insert-YC_URL").click(function(){var e=t.trim(t("#editShortUrl").val());""==e&&alert("请输入链接地址"),ctype="mailurl";changeShortUrl(e,ctype);t(".ke-icon-insertycurl").click()})}(jQuery);var base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64DecodeChars=new Array((-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),62,(-1),(-1),(-1),63,52,53,54,55,56,57,58,59,60,61,(-1),(-1),(-1),(-1),(-1),(-1),(-1),0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,(-1),(-1),(-1),(-1),(-1),(-1),26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,(-1),(-1),(-1),(-1),(-1));jQuery(document).ready(function(t){function e(t){n.animate({"margin-left":"-"+788*t+"px"},500)}t(".closeViewBtn").click(function(){t("#bgBox").hide()}),t("#viewMobileBtn").click(function(){var e=t("#msgCnt").val();t.ajax({type:"post",url:"/NewProject/ajax_get_name/",data:{name:e},dataType:"json",success:function(e){e?(t("#bgBox").show(),t("#viewMobile").show().find(".viewMobileInfo").html(e),t("#viewEmail").hide()):alert("请输入短信内容")}})}),t("#viewEmailBtn").click(function(){var e=t(".ke-edit-iframe").get(0).contentWindow.document.body.innerHTML,n=t("#mailSub").val();t.ajax({type:"post",url:"/NewProject/ajax_get_name1/",data:{name:e,subject:n},dataType:"json",success:function(e){e?(t("#bgBox").show(),t("#viewMobile").hide(),t("#viewEmail").show().find(".title").html(e.subject),t("#viewEmail").show().find(".content").html(e.content)):alert("请输入邮件内容")}})}),t(".show-demo").click(function(){var e=t(this).attr("data-index");t("#bgBox").show(),t("#flash").show().find(".list").find("li").hide(),t("#flash").find(".list").find("li").eq(e).show(),t("#viewMobile").hide(),t("#viewEmail").hide()});var n=t("#flash").find(".list"),a=t("#flash").find(".nav").find("li");a.click(function(){var n=t(this),i=a.index(n);e(i),a.removeClass("on").eq(i).addClass("on")}),t("#flash").find(".close").click(function(){t("#bgBox").hide(),t("#flash").hide()}),t("#msgCnt").scroll(function(){var e=t(this).scrollTop();0==e?t("#tagName").show():t("#tagName").hide()})}),$(function(){$("#payPlanErrorDialog").dialog({autoOpen:!1,width:790,height:550,modal:!0,title:"本次推送预计费用",buttons:[{text:"修改计划",click:function(){$("#isCommit").val("0"),$(this).dialog("close"),"undefined"!=typeof modifyPlanCallBack&&modifyPlanCallBack()}},{text:"去充值",click:function(){window.location.href="/Vouchers/useVoucher?orderid="+orderId}}]}),$("#payPlanSuccessDialog").dialog({autoOpen:!1,width:790,height:550,modal:!0,title:"本次推送预计费用",buttons:[{text:"修改计划",click:function(){$("#isCommit").val("0"),$(this).dialog("close"),"undefined"!=typeof modifyPlanCallBack&&modifyPlanCallBack()}},{text:"确认付款",click:function(){$.ajax({url:"/PayOrder/index",type:"post",data:"orderId="+orderId,success:function(t){var e=promptDialog(t.msg,{ok:function(){window.location.href="/SpreadPlan/index"},OKText:"关闭"});window.setTimeout(function(){e.dialog("close"),window.location.href="/SpreadPlan/index"},3e3)}})}}]}),$("#payPlanUpSeccuesDialog").dialog({width:790,height:550,title:"本次推送预计费用",buttons:[{text:"修改计划",click:function(){$(this).dialog("close"),"undefined"!=typeof modifyPlanCallBack&&modifyPlanCallBack()}},{text:"确认付款",click:function(){var t=$("#tplCnt").serialize(),e=$("#order_id").val(),n=$("#order_status").val(),a=$("#yfcj").html(),i=$("#url").val();$.ajax({url:"/EditPlan/ajax_pay_edit",data:{order_id:e,money:a,data:t,order_status:n},type:"post",dataType:"json",success:function(t){alert(t.msg),window.setTimeout(function(){window.location.href=i},2e3)}})}}]}),$("#payPlanDownSuccessDialog").dialog({width:790,height:550,title:"本次推送预计费用",buttons:[{text:"查看收支明细",click:function(){window.location.href="/FundLogs/fundLogs"}},{text:"查看计划列表",click:function(){window.location.href="/SpreadPlan/index"}}],close:function(){window.location.href="/SpreadPlan/index"}})});